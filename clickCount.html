<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Educational Automation Tool</title>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #856404;
            font-weight: bold;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #e9ecef;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4a5568;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-running {
            background: #48bb78;
            animation: pulse 1.5s infinite;
        }
        
        .status-stopped {
            background: #f56565;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-icon {
            font-size: 1.2rem;
        }
        
        #startBtn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        #startBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 161, 105, 0.4);
        }
        
        #stopBtn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
        
        #stopBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.4);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        #resetBtn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }
        
        #resetBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(49, 130, 206, 0.4);
        }
        
        .storage-btn {
            background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
            color: white;
        }
        
        .storage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 70, 193, 0.4);
        }
        
        .link-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #edf2f7;
            border-radius: 10px;
        }
        
        #testLink {
            display: inline-block;
            padding: 15px 30px;
            background: #4a5568;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        #testLink:hover {
            background: #2d3748;
            transform: translateY(-2px);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .label-icon {
            font-size: 1.1rem;
        }
        
        input[type="number"], input[type="url"], select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        input[type="number"]:focus, input[type="url"]:focus, select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .advanced-section {
            margin-top: 25px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .advanced-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .advanced-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4299e1;
        }
        
        .log-container {
            margin-top: 25px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .log {
            background: #1a202c;
            color: #cbd5e0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.9rem;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-time {
            color: #68d391;
            min-width: 70px;
        }
        
        .log-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .log-type-info { background: #2b6cb0; color: white; }
        .log-type-success { background: #276749; color: white; }
        .log-type-warning { background: #975a16; color: white; }
        .log-type-error { background: #c53030; color: white; }
        
        .log-message {
            color: #cbd5e0;
            flex: 1;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #718096;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .data-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .data-status.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .data-status {
                bottom: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
        }
        
        /* Scrollbar styling */
        .log::-webkit-scrollbar {
            width: 8px;
        }
        
        .log::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 4px;
        }
        
        .log::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        
        .log::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Advanced Automation Tool</h1>
        <div class="subtitle">Educational Testing Platform with Persistent Data Storage</div>
        
        <div class="warning">
            ‚ö†Ô∏è FOR EDUCATIONAL PURPOSES ONLY<br>
            Use only on your own websites or with explicit permission
        </div>
        
        <div class="control-panel">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total Clicks</div>
                    <div id="totalClicks" class="stat-value">0</div>
                    <small id="savedClicks">(Saved: 0)</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Status</div>
                    <div id="status" class="stat-value">
                        <span class="status-indicator status-stopped"></span>
                        Idle
                    </div>
                    <small id="uptime">Uptime: 0s</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Session Duration</div>
                    <div id="sessionTime" class="stat-value">0s</div>
                    <small id="totalTime">Total: 0s</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Success Rate</div>
                    <div id="successRate" class="stat-value">100%</div>
                    <small id="failedClicks">Failed: 0</small>
                </div>
            </div>
            
            <div class="buttons">
                <button id="startBtn" onclick="startAutomation()">
                    <span class="btn-icon">‚ñ∂</span>
                    Start Automation
                </button>
                <button id="stopBtn" onclick="stopAutomation()" disabled>
                    <span class="btn-icon">‚è∏</span>
                    Stop Automation
                </button>
                <button id="resetBtn" onclick="resetStats()">
                    <span class="btn-icon">üîÑ</span>
                    Reset Stats
                </button>
                <button class="storage-btn" onclick="exportData()">
                    <span class="btn-icon">üíæ</span>
                    Export Data
                </button>
                <button class="storage-btn" onclick="importData()">
                    <span class="btn-icon">üì•</span>
                    Import Data
                </button>
            </div>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label>
                        <span class="label-icon">‚è±Ô∏è</span>
                        Delay Between Clicks (seconds):
                    </label>
                    <input type="number" id="clickDelay" min="0.5" max="3600" value="5" step="0.5">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">üéØ</span>
                        Max Clicks (0 = unlimited):
                    </label>
                    <input type="number" id="maxClicks" min="0" max="10000" value="50">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">üåê</span>
                        Target URL:
                    </label>
                    <input type="url" id="targetUrl" value="https://example.com" placeholder="https://your-test-site.com">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">‚ÜóÔ∏è</span>
                        Open Link In:
                    </label>
                    <select id="openInNewTab">
                        <option value="_blank">New Tab</option>
                        <option value="_self">Same Tab</option>
                        <option value="_parent">Parent Frame</option>
                    </select>
                </div>
            </div>
            
            <div class="advanced-section">
                <div class="advanced-header" onclick="toggleAdvanced()">
                    <h3>‚öôÔ∏è Advanced Settings</h3>
                    <span id="advancedToggle">‚ñº</span>
                </div>
                <div id="advancedContent" class="advanced-content" style="display: none;">
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoResume" checked>
                        <label for="autoResume">Auto-resume on reload</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="saveLogs" checked>
                        <label for="saveLogs">Persistent logs</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="notifications" checked>
                        <label for="notifications">Desktop notifications</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="randomDelay" checked>
                        <label for="randomDelay">¬±10% random delay</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoSave" checked>
                        <label for="autoSave">Auto-save every 30s</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="soundEffects">
                        <label for="soundEffects">Sound effects</label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="link-section">
            <h3>üéØ Target Link Preview</h3>
            <a id="testLink" href="https://example.com" target="_blank">
                üîó Click to Test (Simulated)
            </a>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #718096;">
                Opens in: <span id="linkTargetPreview">New Tab</span>
            </div>
        </div>
        
        <div class="log-container">
            <div class="log-header">
                <h3>üìã Activity Log</h3>
                <button onclick="clearLogs()" style="padding: 8px 15px; font-size: 0.9rem;">Clear Logs</button>
            </div>
            <div class="log" id="activityLog">
                <!-- Log entries will appear here -->
            </div>
        </div>
        
        <div class="footer">
            <div>üì± Data automatically saved to your device ‚Ä¢ üîÑ Auto-save enabled</div>
            <div style="margin-top: 10px; font-size: 0.8rem;">
                Last saved: <span id="lastSaved">Never</span> | 
                Storage used: <span id="storageUsed">0 KB</span>
            </div>
        </div>
    </div>

    <div class="data-status" id="dataStatus"></div>

    <script>
        // Storage Configuration
        const STORAGE_CONFIG = {
            CLICK_COUNT: 'automation_clicks_v2',
            SETTINGS: 'automation_settings_v2',
            LOGS: 'automation_logs_v2',
            SESSION: 'automation_session_v2',
            STATS: 'automation_stats_v2',
            HISTORY: 'automation_history_v2'
        };

        // Application State
        let state = {
            clickCount: 0,
            automationActive: false,
            automationTimeout: null,
            sessionStartTime: null,
            sessionInterval: null,
            totalUptime: 0,
            failedClicks: 0,
            lastClickTime: null,
            autoSaveInterval: null
        };

        // DOM Elements
        const elements = {
            totalClicks: document.getElementById('totalClicks'),
            status: document.getElementById('status'),
            sessionTime: document.getElementById('sessionTime'),
            activityLog: document.getElementById('activityLog'),
            startBtn: document.getElementById('startBtn'),
            stopBtn: document.getElementById('stopBtn'),
            testLink: document.getElementById('testLink'),
            savedClicks: document.getElementById('savedClicks'),
            uptime: document.getElementById('uptime'),
            totalTime: document.getElementById('totalTime'),
            successRate: document.getElementById('successRate'),
            failedClicks: document.getElementById('failedClicks'),
            lastSaved: document.getElementById('lastSaved'),
            storageUsed: document.getElementById('storageUsed'),
            dataStatus: document.getElementById('dataStatus'),
            linkTargetPreview: document.getElementById('linkTargetPreview')
        };

        // Initialize Application
        initApplication();

        function initApplication() {
            loadAllData();
            updateTargetLink();
            setupEventListeners();
            startAutoSave();
            updateStorageInfo();
            showDataStatus('Application loaded successfully', 'success');
        }

        function loadAllData() {
            try {
                // Load click count
                const savedClicks = localStorage.getItem(STORAGE_CONFIG.CLICK_COUNT);
                if (savedClicks) {
                    state.clickCount = parseInt(savedClicks);
                    elements.totalClicks.textContent = state.clickCount;
                    elements.savedClicks.textContent = `(Saved: ${state.clickCount})`;
                }

                // Load settings
                const savedSettings = localStorage.getItem(STORAGE_CONFIG.SETTINGS);
                if (savedSettings) {
                    const settings = JSON.parse(savedSettings);
                    document.getElementById('clickDelay').value = settings.clickDelay || 5;
                    document.getElementById('maxClicks').value = settings.maxClicks || 50;
                    document.getElementById('targetUrl').value = settings.targetUrl || 'https://example.com';
                    document.getElementById('openInNewTab').value = settings.openInNewTab || '_blank';
                    document.getElementById('autoResume').checked = settings.autoResume !== false;
                    document.getElementById('saveLogs').checked = settings.saveLogs !== false;
                    document.getElementById('notifications').checked = settings.notifications !== false;
                    document.getElementById('randomDelay').checked = settings.randomDelay !== false;
                    document.getElementById('autoSave').checked = settings.autoSave !== false;
                    document.getElementById('soundEffects').checked = settings.soundEffects || false;
                }

                // Load statistics
                const savedStats = localStorage.getItem(STORAGE_CONFIG.STATS);
                if (savedStats) {
                    const stats = JSON.parse(savedStats);
                    state.totalUptime = stats.totalUptime || 0;
                    state.failedClicks = stats.failedClicks || 0;
                    updateStatistics();
                }

                // Load logs if enabled
                if (document.getElementById('saveLogs').checked) {
                    const savedLogs = localStorage.getItem(STORAGE_CONFIG.LOGS);
                    if (savedLogs) {
                        elements.activityLog.innerHTML = savedLogs;
                    }
                }

                // Load last saved timestamp
                const lastSaved = localStorage.getItem('last_saved_timestamp');
                if (lastSaved) {
                    elements.lastSaved.textContent = new Date(parseInt(lastSaved)).toLocaleTimeString();
                }

                // Check for auto-resume
                const savedSession = localStorage.getItem(STORAGE_CONFIG.SESSION);
                if (savedSession && document.getElementById('autoResume').checked) {
                    const session = JSON.parse(savedSession);
                    if (session.active) {
                        setTimeout(() => {
                            logActivity("Resuming previous session...", 'info');
                            startAutomation();
                        }, 500);
                    }
                }

                logActivity("All data loaded from persistent storage", 'success');
            } catch (error) {
                console.error("Error loading data:", error);
                logActivity("Error loading saved data", 'error');
            }
        }

        function saveAllData() {
            try {
                // Save current state
                localStorage.setItem(STORAGE_CONFIG.CLICK_COUNT, state.clickCount.toString());

                // Save settings
                const settings = {
                    clickDelay: document.getElementById('clickDelay').value,
                    maxClicks: document.getElementById('maxClicks').value,
                    targetUrl: document.getElementById('targetUrl').value,
                    openInNewTab: document.getElementById('openInNewTab').value,
                    autoResume: document.getElementById('autoResume').checked,
                    saveLogs: document.getElementById('saveLogs').checked,
                    notifications: document.getElementById('notifications').checked,
                    randomDelay: document.getElementById('randomDelay').checked,
                    autoSave: document.getElementById('autoSave').checked,
                    soundEffects: document.getElementById('soundEffects').checked,
                    lastUpdated: new Date().toISOString()
                };
                localStorage.setItem(STORAGE_CONFIG.SETTINGS, JSON.stringify(settings));

                // Save statistics
                const stats = {
                    totalUptime: state.totalUptime,
                    failedClicks: state.failedClicks,
                    totalClicks: state.clickCount,
                    lastSession: state.sessionStartTime || null
                };
                localStorage.setItem(STORAGE_CONFIG.STATS, JSON.stringify(stats));

                // Save logs if enabled
                if (document.getElementById('saveLogs').checked) {
                    localStorage.setItem(STORAGE_CONFIG.LOGS, elements.activityLog.innerHTML);
                }

                // Save session state
                const session = {
                    active: state.automationActive,
                    startTime: state.sessionStartTime,
                    clickCount: state.clickCount,
                    lastUpdate: Date.now()
                };
                localStorage.setItem(STORAGE_CONFIG.SESSION, JSON.stringify(session));

                // Update last saved timestamp
                const now = Date.now();
                localStorage.setItem('last_saved_timestamp', now.toString());
                elements.lastSaved.textContent = new Date(now).toLocaleTimeString();

                // Update storage info
                updateStorageInfo();

                // Show save confirmation
                showDataStatus('Data saved successfully', 'success');
            } catch (error) {
                console.error("Error saving data:", error);
                showDataStatus('Error saving data', 'error');
            }
        }

        function updateTargetLink() {
            const url = document.getElementById('targetUrl').value;
            const target = document.getElementById('openInNewTab').value;
            
            elements.testLink.href = url;
            elements.testLink.target = target;
            
            // Update preview text
            const targetText = target === '_blank' ? 'New Tab' : 
                             target === '_self' ? 'Same Tab' : 'Parent Frame';
            elements.linkTargetPreview.textContent = targetText;
            
            // Save settings
            if (document.getElementById('autoSave').checked) {
                saveAllData();
            }
        }

        function logActivity(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = document.createElement('div');
            logEntry.className = 'log-entry';
            
            const typeText = type.charAt(0).toUpperCase() + type.slice(1);
            logEntry.innerHTML = `
                <span class="log-time">${timestamp}</span>
                <span class="log-type log-type-${type}">${typeText}</span>
                <span class="log-message">${message}</span>
            `;
            
            elements.activityLog.prepend(logEntry);
            
            // Keep log manageable
            if (elements.activityLog.children.length > 100) {
                elements.activityLog.removeChild(elements.activityLog.lastChild);
            }
            
            // Play sound if enabled
            if (document.getElementById('soundEffects').checked && type === 'error') {
                playSound('error');
            }
            
            // Auto-save logs if enabled
            if (document.getElementById('saveLogs').checked && document.getElementById('autoSave').checked) {
                localStorage.setItem(STORAGE_CONFIG.LOGS, elements.activityLog.innerHTML);
            }
        }

        function updateSessionTimer() {
            if (state.sessionStartTime) {
                const elapsed = Math.floor((Date.now() - state.sessionStartTime) / 1000);
                elements.sessionTime.textContent = `${elapsed}s`;
                
                // Update total uptime display
                const totalUptime = state.totalUptime + elapsed;
                const hours = Math.floor(totalUptime / 3600);
                const minutes = Math.floor((totalUptime % 3600) / 60);
                const seconds = totalUptime % 60;
                elements.uptime.textContent = `Uptime: ${hours}h ${minutes}m ${seconds}s`;
            }
        }

        function updateStatistics() {
            // Update success rate
            const totalAttempts = state.clickCount + state.failedClicks;
            const successRate = totalAttempts > 0 ? 
                Math.round((state.clickCount / totalAttempts) * 100) : 100;
            elements.successRate.textContent = `${successRate}%`;
            elements.failedClicks.textContent = `Failed: ${state.failedClicks}`;
            
            // Update total time
            const totalTime = state.totalUptime;
            const hours = Math.floor(totalTime / 3600);
            const minutes = Math.floor((totalTime % 3600) / 60);
            elements.totalTime.textContent = `Total: ${hours}h ${minutes}m`;
        }

        function simulateClick() {
            if (!state.automationActive) return;
            
            const maxClicks = parseInt(document.getElementById('maxClicks').value);
            let delay = parseFloat(document.getElementById('clickDelay').value) * 1000;
            
            // Add random variation if enabled
            if (document.getElementById('randomDelay').checked) {
                const variation = delay * 0.1; // ¬±10%
                delay += (Math.random() * variation * 2) - variation;
            }
            
            // Check if we've reached max clicks
            if (maxClicks > 0 && state.clickCount >= maxClicks) {
                logActivity("Maximum clicks reached. Automation stopped.", 'info');
                stopAutomation();
                return;
            }
            
            try {
                // Update link before clicking
                updateTargetLink();
                
                // Simulate click
                const event = new MouseEvent('click', {
                    view: window,
                    bubbles: true,
                    cancelable: true
                });
                
                elements.testLink.dispatchEvent(event);
                state.clickCount++;
                elements.totalClicks.textContent = state.clickCount;
                state.lastClickTime = Date.now();
                
                // Show notification if enabled
                if (document.getElementById('notifications').checked) {
                    showNotification(`Click #${state.clickCount} simulated`);
                }
                
                logActivity(`Click #${state.clickCount} simulated. Opening: ${elements.testLink.href}`, 'success');
                
                // Play sound if enabled
                if (document.getElementById('soundEffects').checked) {
                    playSound('click');
                }
                
                // Save progress
                saveAllData();
                
                // Schedule next click
                if (state.automationActive) {
                    state.automationTimeout = setTimeout(simulateClick, delay);
                }
            } catch (error) {
                state.failedClicks++;
                logActivity(`Error on click #${state.clickCount + 1}: ${error.message}`, 'error');
                updateStatistics();
                
                // Retry after error delay
                if (state.automationActive) {
                    state.automationTimeout = setTimeout(simulateClick, 5000); // 5 second delay on error
                }
            }
        }

        function startAutomation() {
            if (state.automationActive) return;
            
            state.automationActive = true;
            state.sessionStartTime = Date.now();
            
            // Update UI
            elements.startBtn.disabled = true;
            elements.stopBtn.disabled = false;
            elements.status.innerHTML = '<span class="status-indicator status-running"></span> Running';
            elements.status.style.color = '#48bb78';
            
            logActivity("Automation started successfully", 'success');
            
            // Start session timer
            state.sessionInterval = setInterval(updateSessionTimer, 1000);
            
            // Save session state
            saveAllData();
            
            // Show notification if enabled
            if (document.getElementById('notifications').checked) {
                showNotification("Automation started");
            }
            
            // Start clicking with initial delay
            const initialDelay = 2000; // 2 second delay before first click
            state.automationTimeout = setTimeout(simulateClick, initialDelay);
        }

        function stopAutomation() {
            if (!state.automationActive) return;
            
            state.automationActive = false;
            
            // Calculate and save total uptime
            if (state.sessionStartTime) {
                const sessionUptime = Math.floor((Date.now() - state.sessionStartTime) / 1000);
                state.totalUptime += sessionUptime;
                state.sessionStartTime = null;
            }
            
            // Clear timeouts
            if (state.automationTimeout) {
                clearTimeout(state.automationTimeout);
                state.automationTimeout = null;
            }
            
            if (state.sessionInterval) {
                clearInterval(state.sessionInterval);
                state.sessionInterval = null;
            }
            
            // Update UI
            elements.startBtn.disabled = false;
            elements.stopBtn.disabled = true;
            elements.status.innerHTML = '<span class="status-indicator status-stopped"></span> Stopped';
            elements.status.style.color = '#f56565';
            
            // Update statistics
            updateStatistics();
            
            logActivity("Automation stopped", 'info');
            
            // Save final state
            saveAllData();
            
            // Show notification if enabled
            if (document.getElementById('notifications').checked) {
                showNotification("Automation stopped");
            }
        }

        function resetStats() {
            if (confirm("Are you sure you want to reset all statistics? This cannot be undone.")) {
                state.clickCount = 0;
                state.failedClicks = 0;
                state.totalUptime = 0;
                
                elements.totalClicks.textContent = '0';
                elements.sessionTime.textContent = '0s';
                elements.uptime.textContent = 'Uptime: 0s';
                
                if (state.automationActive) {
                    stopAutomation();
                }
                
                updateStatistics();
                saveAllData();
                logActivity("All statistics have been reset", 'warning');
            }
        }

        function exportData() {
            const data = {
                metadata: {
                    version: '2.0',
                    exportDate: new Date().toISOString(),
                    tool: 'Educational Automation Tool'
                },
                statistics: {
                    clickCount: state.clickCount,
                    failedClicks: state.failedClicks,
                    totalUptime: state.totalUptime,
                    lastClick: state.lastClickTime ? new Date(state.lastClickTime).toISOString() : null
                },
                settings: {
                    clickDelay: document.getElementById('clickDelay').value,
                    maxClicks: document.getElementById('maxClicks').value,
                    targetUrl: document.getElementById('targetUrl').value,
                    openInNewTab: document.getElementById('openInNewTab').value
                },
                logs: elements.activityLog.innerHTML,
                session: {
                    active: state.automationActive,
                    startTime: state.sessionStartTime
                }
            };
            
            const dataStr = JSON.stringify(data, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const a = document.createElement('a');
            a.href = url;
            const dateStr = new Date().toISOString().split('T')[0];
            a.download = `automation-backup-${dateStr}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            
            logActivity("Data exported to backup file", 'success');
            showDataStatus('Data exported successfully', 'success');
        }

        function importData() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.json';
            
            input.onchange = function(e) {
                const file = e.target.files[0];
                if (!file) return;
                
                const reader = new FileReader();
                
                reader.onload = function(event) {
                    try {
                        const data = JSON.parse(event.target.result);
                        
                        // Import statistics
                        if (data.statistics) {
                            state.clickCount = parseInt(data.statistics.clickCount) || 0;
                            state.failedClicks = parseInt(data.statistics.failedClicks) || 0;
                            state.totalUptime = parseInt(data.statistics.totalUptime) || 0;
                            
                            elements.totalClicks.textContent = state.clickCount;
                            updateStatistics();
                        }
                        
                        // Import settings
                        if (data.settings) {
                            document.getElementById('clickDelay').value = data.settings.clickDelay || 5;
                            document.getElementById('maxClicks').value = data.settings.maxClicks || 50;
                            document.getElementById('targetUrl').value = data.settings.targetUrl || 'https://example.com';
                            document.getElementById('openInNewTab').value = data.settings.openInNewTab || '_blank';
                            updateTargetLink();
                        }
                        
                        // Import logs
                        if (data.logs) {
                            elements.activityLog.innerHTML = data.logs;
                        }
                        
                        saveAllData();
                        logActivity(`Data imported from backup (${data.metadata?.exportDate || 'unknown date'})`, 'success');
                        showDataStatus('Data imported successfully', 'success');
                        
                    } catch (error) {
                        logActivity("Error importing data: Invalid file format", 'error');
                        showDataStatus('Import failed: Invalid file', 'error');
                    }
                };
                
                reader.readAsText(file);
            };
            
            input.click();
        }

        function clearLogs() {
            if (confirm("Clear all activity logs?")) {
                elements.activityLog.innerHTML = '';
                localStorage.removeItem(STORAGE_CONFIG.LOGS);
                logActivity("All logs cleared", 'warning');
            }
        }

        function toggleAdvanced() {
            const content = document.getElementById('advancedContent');
            const toggle = document.getElementById('advancedToggle');
            
            if (content.style.display === 'none') {
                content.style.display = 'grid';
                toggle.textContent = '‚ñ≤';
            } else {
                content.style.display = 'none';
                toggle.textContent = '‚ñº';
            }
        }

        function startAutoSave() {
            if (state.autoSaveInterval) {
                clearInterval(state.autoSaveInterval);
            }
            
            state.autoSaveInterval = setInterval(() => {
                if (document.getElementById('autoSave').checked) {
                    saveAllData();
                    // Flash the save indicator
                    showDataStatus('Auto-saved', 'info', 1000);
                }
            }, 30000); // Auto-save every 30 seconds
        }

        function updateStorageInfo() {
            let totalSize = 0;
            for (let key in localStorage) {
                if (localStorage.hasOwnProperty(key)) {
                    totalSize += localStorage[key].length * 2; // Approximate size in bytes
                }
            }
            elements.storageUsed.textContent = `${(totalSize / 1024).toFixed(2)} KB`;
        }

        function showDataStatus(message, type = 'info', duration = 3000) {
            elements.dataStatus.textContent = message;
            elements.dataStatus.style.background = type === 'success' ? '#48bb78' : 
                                                   type === 'error' ? '#f56565' : 
                                                   type === 'warning' ? '#ed8936' : '#4299e1';
            
            elements.dataStatus.classList.add('show');
            
            setTimeout(() => {
                elements.dataStatus.classList.remove('show');
            }, duration);
        }

        function showNotification(message) {
            if (!("Notification" in window)) return;
            
            if (Notification.permission === "granted") {
                new Notification("Automation Tool", {
                    body: message,
                    icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2348bb78"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>'
                });
            } else if (Notification.permission !== "denied") {
                Notification.requestPermission();
            }
        }

        function playSound(type) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                
                if (type === 'click') {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 800;
                    oscillator.type = 'sine';
                    
                    gainNode.gain.setValueAtTime(0.1, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.1);
                    
                } else if (type === 'error') {
                    const oscillator = audioContext.createOscillator();
                    const gainNode = audioContext.createGain();
                    
                    oscillator.connect(gainNode);
                    gainNode.connect(audioContext.destination);
                    
                    oscillator.frequency.value = 300;
                    oscillator.type = 'sawtooth';
                    
                    gainNode.gain.setValueAtTime(0.2, audioContext.currentTime);
                    gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.3);
                    
                    oscillator.start(audioContext.currentTime);
                    oscillator.stop(audioContext.currentTime + 0.3);
                }
            } catch (error) {
                console.log("Audio not supported");
            }
        }

        function setupEventListeners() {
            // Settings change listeners
            document.getElementById('targetUrl').addEventListener('input', updateTargetLink);
            document.getElementById('openInNewTab').addEventListener('change', updateTargetLink);
            
            document.getElementById('clickDelay').addEventListener('change', function() {
                logActivity(`Click delay changed to ${this.value} seconds`, 'info');
                saveAllData();
            });
            
            document.getElementById('maxClicks').addEventListener('change', function() {
                logActivity(`Maximum clicks changed to ${this.value}`, 'info');
                saveAllData();
            });
            
            // Advanced settings listeners
            document.getElementById('autoSave').addEventListener('change', function() {
                if (this.checked) {
                    startAutoSave();
                    showDataStatus('Auto-save enabled', 'success');
                } else {
                    clearInterval(state.autoSaveInterval);
                    showDataStatus('Auto-save disabled', 'warning');
                }
                saveAllData();
            });
            
            // Keyboard shortcuts
            document.addEventListener('keydown', function(e) {
                // Space to toggle automation
                if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                    e.preventDefault();
                    if (state.automationActive) {
                        stopAutomation();
                    } else {
                        startAutomation();
                    }
                }
                // Ctrl/Cmd + S to start
                if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                    e.preventDefault();
                    startAutomation();
                }
                // Ctrl/Cmd + P to stop
                if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                    e.preventDefault();
                    stopAutomation();
                }
                // Escape to stop
                if (e.key === 'Escape') {
                    stopAutomation();
                }
                // Ctrl/Cmd + E to export
                if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                    e.preventDefault();
                    exportData();
                }
            });
            
            // Visibility change handling
            document.addEventListener('visibilitychange', function() {
                if (document.hidden && state.automationActive) {
                    logActivity("Browser tab hidden - automation continues in background", 'info');
                }
            });
            
            // Before unload warning
            window.addEventListener('beforeunload', function(e) {
                if (state.automationActive) {
                    e.preventDefault();
                    e.returnValue = 'Automation is still running. Are you sure you want to leave?';
                    return e.returnValue;
                }
            });
        }

        // Initial log entry
        logActivity("Advanced Automation Tool initialized with persistent storage", 'success');
    </script>
</body>
</html>