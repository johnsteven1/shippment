<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced Educational Automation Tool</title>
    <style>
        /* All existing CSS remains exactly the same */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }
        
        body {
            font-family: 'Segoe UI', Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            color: #333;
        }
        
        .container {
            max-width: 1000px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
        }
        
        h1 {
            color: #2d3748;
            text-align: center;
            margin-bottom: 10px;
            font-size: 2.5rem;
        }
        
        .subtitle {
            text-align: center;
            color: #718096;
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin: 20px 0;
            text-align: center;
            color: #856404;
            font-weight: bold;
        }
        
        .control-panel {
            background: #f8f9fa;
            border-radius: 10px;
            padding: 25px;
            margin: 25px 0;
            border: 2px solid #e9ecef;
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 15px;
            margin-bottom: 25px;
        }
        
        .stat-box {
            background: white;
            padding: 20px;
            border-radius: 8px;
            text-align: center;
            border: 1px solid #dee2e6;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: transform 0.3s ease;
        }
        
        .stat-box:hover {
            transform: translateY(-5px);
        }
        
        .stat-value {
            font-size: 2.2rem;
            font-weight: bold;
            color: #4a5568;
            margin: 10px 0;
        }
        
        .stat-label {
            color: #718096;
            font-size: 0.9rem;
            text-transform: uppercase;
            letter-spacing: 1px;
        }
        
        .status-indicator {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
        }
        
        .status-running {
            background: #48bb78;
            animation: pulse 1.5s infinite;
        }
        
        .status-stopped {
            background: #f56565;
        }
        
        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }
        
        .buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin: 20px 0;
            flex-wrap: wrap;
        }
        
        button {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            min-width: 150px;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }
        
        .btn-icon {
            font-size: 1.2rem;
        }
        
        #startBtn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        #startBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(56, 161, 105, 0.4);
        }
        
        #stopBtn {
            background: linear-gradient(135deg, #f56565 0%, #e53e3e 100%);
            color: white;
        }
        
        #stopBtn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(229, 62, 62, 0.4);
        }
        
        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none !important;
            box-shadow: none !important;
        }
        
        #resetBtn {
            background: linear-gradient(135deg, #4299e1 0%, #3182ce 100%);
            color: white;
        }
        
        #resetBtn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(49, 130, 206, 0.4);
        }
        
        .storage-btn {
            background: linear-gradient(135deg, #805ad5 0%, #6b46c1 100%);
            color: white;
        }
        
        .storage-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(107, 70, 193, 0.4);
        }
        
        .link-section {
            text-align: center;
            margin: 30px 0;
            padding: 20px;
            background: #edf2f7;
            border-radius: 10px;
        }
        
        #testLink {
            display: inline-block;
            padding: 15px 30px;
            background: #4a5568;
            color: white;
            text-decoration: none;
            border-radius: 8px;
            font-size: 1.1rem;
            transition: all 0.3s ease;
        }
        
        #testLink:hover {
            background: #2d3748;
            transform: translateY(-2px);
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-top: 25px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        
        label {
            font-weight: 600;
            color: #4a5568;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .label-icon {
            font-size: 1.1rem;
        }
        
        input[type="number"], input[type="url"], select {
            padding: 12px;
            border: 2px solid #e2e8f0;
            border-radius: 6px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: white;
        }
        
        input[type="number"]:focus, input[type="url"]:focus, select:focus {
            outline: none;
            border-color: #4299e1;
            box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
        }
        
        .advanced-section {
            margin-top: 25px;
            padding: 20px;
            background: #f7fafc;
            border-radius: 10px;
            border: 1px solid #e2e8f0;
        }
        
        .advanced-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            margin-bottom: 15px;
        }
        
        .advanced-content {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 15px;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 10px;
            background: white;
            border-radius: 6px;
            border: 1px solid #e2e8f0;
        }
        
        input[type="checkbox"] {
            width: 18px;
            height: 18px;
            accent-color: #4299e1;
        }
        
        .log-container {
            margin-top: 25px;
        }
        
        .log-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .log {
            background: #1a202c;
            color: #cbd5e0;
            padding: 20px;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            height: 250px;
            overflow-y: auto;
            white-space: pre-wrap;
            font-size: 0.9rem;
        }
        
        .log-entry {
            padding: 8px 0;
            border-bottom: 1px solid #2d3748;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .log-time {
            color: #68d391;
            min-width: 70px;
        }
        
        .log-type {
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 0.8rem;
            font-weight: bold;
        }
        
        .log-type-info { background: #2b6cb0; color: white; }
        .log-type-success { background: #276749; color: white; }
        .log-type-warning { background: #975a16; color: white; }
        .log-type-error { background: #c53030; color: white; }
        
        .log-message {
            color: #cbd5e0;
            flex: 1;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #718096;
            font-size: 0.9rem;
            padding-top: 20px;
            border-top: 1px solid #e2e8f0;
        }
        
        .data-status {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: #48bb78;
            color: white;
            padding: 10px 15px;
            border-radius: 8px;
            font-size: 0.9rem;
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
        }
        
        .data-status.show {
            opacity: 1;
            transform: translateY(0);
        }
        
        /* Health status from first script - ADDED */
        .health {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #1a202c;
            color: #68d391;
            padding: 10px 14px;
            border-radius: 10px;
            font-size: 0.85rem;
            box-shadow: 0 8px 20px rgba(0,0,0,.25);
            z-index: 1000;
        }
        
        .health span {
            color: #fff;
        }
        
        /* Permission dialog styles */
        .permission-dialog {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.85);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            backdrop-filter: blur(5px);
        }
        
        .permission-box {
            background: white;
            border-radius: 15px;
            padding: 40px;
            max-width: 500px;
            width: 90%;
            text-align: center;
            box-shadow: 0 20px 60px rgba(0,0,0,0.4);
            animation: slideIn 0.5s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateY(-30px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }
        
        .permission-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        
        .permission-title {
            font-size: 1.8rem;
            margin-bottom: 15px;
            color: #2d3748;
        }
        
        .permission-text {
            color: #718096;
            line-height: 1.6;
            margin-bottom: 25px;
        }
        
        .permission-buttons {
            display: flex;
            gap: 15px;
            justify-content: center;
            margin-top: 30px;
        }
        
        .permission-btn {
            padding: 12px 30px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            min-width: 120px;
        }
        
        #grantPermissionBtn {
            background: linear-gradient(135deg, #48bb78 0%, #38a169 100%);
            color: white;
        }
        
        #denyPermissionBtn {
            background: #e2e8f0;
            color: #4a5568;
        }
        
        .permission-features {
            background: #f7fafc;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            text-align: left;
        }
        
        .permission-features ul {
            list-style: none;
            padding: 0;
        }
        
        .permission-features li {
            padding: 8px 0;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .permission-features li:before {
            content: "‚úì";
            color: #48bb78;
            font-weight: bold;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 15px;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .buttons {
                flex-direction: column;
            }
            
            button {
                width: 100%;
            }
            
            .data-status {
                bottom: 10px;
                right: 10px;
                left: 10px;
                text-align: center;
            }
            
            .health {
                position: relative;
                top: 0;
                right: 0;
                margin-bottom: 20px;
                text-align: center;
            }
            
            .permission-box {
                padding: 25px;
                width: 95%;
            }
            
            .permission-buttons {
                flex-direction: column;
            }
            
            .permission-btn {
                width: 100%;
            }
        }
        
        /* Scrollbar styling */
        .log::-webkit-scrollbar {
            width: 8px;
        }
        
        .log::-webkit-scrollbar-track {
            background: #2d3748;
            border-radius: 4px;
        }
        
        .log::-webkit-scrollbar-thumb {
            background: #4a5568;
            border-radius: 4px;
        }
        
        .log::-webkit-scrollbar-thumb:hover {
            background: #718096;
        }
    </style>
</head>
<body>
    <!-- Permission Dialog - ADDED -->
    <div class="permission-dialog" id="permissionDialog">
        <div class="permission-box">
            <div class="permission-icon">üîí</div>
            <h2 class="permission-title">Permission Required</h2>
            <p class="permission-text">
                This educational automation tool requires certain permissions to function properly. 
                Please review and grant the permissions below to enable all features.
            </p>
            
            <div class="permission-features">
                <ul>
                    <li>Persistent data storage (IndexedDB & localStorage)</li>
                    <li>Desktop notifications for automation status</li>
                    <li>Browser automation capabilities</li>
                    <li>Background processing with Web Workers</li>
                    <li>Cross-tab communication for session management</li>
                </ul>
            </div>
            
            <p class="permission-text" style="font-size: 0.9rem;">
                <strong>Note:</strong> All data is stored locally on your device. No data is sent to external servers.
                This tool is for educational purposes only.
            </p>
            
            <div class="permission-buttons">
                <button class="permission-btn" id="grantPermissionBtn">Grant All Permissions</button>
                <button class="permission-btn" id="denyPermissionBtn">Continue with Limited Features</button>
            </div>
        </div>
    </div>

    <!-- Health status from first script - ADDED -->
    <div class="health">
        Status: <span id="healthStatus">OK</span><br>
        Heartbeat: <span id="heartbeat">0</span>
    </div>

    <div class="container">
        <h1>ü§ñ Advanced Automation Tool</h1>
        <div class="subtitle">Educational Testing Platform with Persistent Data Storage</div>
        
        <div class="warning">
            ‚ö†Ô∏è FOR EDUCATIONAL PURPOSES ONLY<br>
            Use only on your own websites or with explicit permission
        </div>
        
        <div class="control-panel">
            <div class="stats-grid">
                <div class="stat-box">
                    <div class="stat-label">Total Clicks</div>
                    <div id="totalClicks" class="stat-value">0</div>
                    <small id="savedClicks">(Saved: 0)</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Status</div>
                    <div id="status" class="stat-value">
                        <span class="status-indicator status-stopped"></span>
                        Idle
                    </div>
                    <small id="uptime">Uptime: 0s</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Session Duration</div>
                    <div id="sessionTime" class="stat-value">0s</div>
                    <small id="totalTime">Total: 0s</small>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Success Rate</div>
                    <div id="successRate" class="stat-value">100%</div>
                    <small id="failedClicks">Failed: 0</small>
                </div>
            </div>
            
            <div class="buttons">
                <button id="startBtn">
                    <span class="btn-icon">‚ñ∂</span>
                    Start Automation
                </button>
                <button id="stopBtn" disabled>
                    <span class="btn-icon">‚è∏</span>
                    Stop Automation
                </button>
                <button id="resetBtn">
                    <span class="btn-icon">üîÑ</span>
                    Reset Stats
                </button>
                <button class="storage-btn" id="exportBtn">
                    <span class="btn-icon">üíæ</span>
                    Export Data
                </button>
                <button class="storage-btn" id="importBtn">
                    <span class="btn-icon">üì•</span>
                    Import Data
                </button>
            </div>
            
            <div class="settings-grid">
                <div class="setting-group">
                    <label>
                        <span class="label-icon">‚è±Ô∏è</span>
                        Delay Between Clicks (seconds):
                    </label>
                    <input type="number" id="clickDelay" min="0.5" max="3600" value="5" step="0.5">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">üéØ</span>
                        Max Clicks (0 = unlimited):
                    </label>
                    <input type="number" id="maxClicks" min="0" max="10000" value="50">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">üåê</span>
                        Target URL:
                    </label>
                    <input type="url" id="targetUrl" value="https://example.com" placeholder="https://your-test-site.com">
                </div>
                <div class="setting-group">
                    <label>
                        <span class="label-icon">‚ÜóÔ∏è</span>
                        Open Link In:
                    </label>
                    <select id="openInNewTab">
                        <option value="_blank">New Tab</option>
                        <option value="_self">Same Tab</option>
                        <option value="_parent">Parent Frame</option>
                    </select>
                </div>
            </div>
            
            <div class="advanced-section">
                <div class="advanced-header" id="advancedHeader">
                    <h3>‚öôÔ∏è Advanced Settings</h3>
                    <span id="advancedToggle">‚ñº</span>
                </div>
                <div id="advancedContent" class="advanced-content" style="display: none;">
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoResume" checked>
                        <label for="autoResume">Auto-resume on reload</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="saveLogs" checked>
                        <label for="saveLogs">Persistent logs</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="notifications" checked>
                        <label for="notifications">Desktop notifications</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="randomDelay" checked>
                        <label for="randomDelay">¬±10% random delay</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="autoSave" checked>
                        <label for="autoSave">Auto-save every 30s</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="soundEffects">
                        <label for="soundEffects">Sound effects</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useIndexedDB" checked>
                        <label for="useIndexedDB">Use IndexedDB (persistent)</label>
                    </div>
                    <div class="checkbox-group">
                        <input type="checkbox" id="useWebWorker" checked>
                        <label for="useWebWorker">Use Web Worker timer</label>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="link-section">
            <h3>üéØ Target Link Preview</h3>
            <a id="testLink" href="https://example.com" target="_blank">
                üîó Click to Test (Simulated)
            </a>
            <div style="margin-top: 10px; font-size: 0.9rem; color: #718096;">
                Opens in: <span id="linkTargetPreview">New Tab</span>
            </div>
        </div>
        
        <div class="log-container">
            <div class="log-header">
                <h3>üìã Activity Log</h3>
                <button id="clearLogsBtn" style="padding: 8px 15px; font-size: 0.9rem;">Clear Logs</button>
            </div>
            <div class="log" id="activityLog">
                <!-- Log entries will appear here -->
            </div>
        </div>
        
        <div class="footer">
            <div>üì± Data automatically saved to your device ‚Ä¢ üîÑ Auto-save enabled ‚Ä¢ ü§ñ Web Worker Active</div>
            <div style="margin-top: 10px; font-size: 0.8rem;">
                Last saved: <span id="lastSaved">Never</span> | 
                Storage used: <span id="storageUsed">0 KB</span> |
                DB Status: <span id="dbStatus">Waiting for permissions...</span>
            </div>
        </div>
    </div>

    <div class="data-status" id="dataStatus"></div>

    <script>
        // ===============================
        // CLASS-BASED AUTOMATION SYSTEM
        // ===============================
        class AutomationTool {
            constructor() {
                this.initialized = false;
                this.permissions = {
                    storage: false,
                    notifications: false,
                    worker: false,
                    automation: false
                };
                
                this.state = {
                    clickCount: 0,
                    automationActive: false,
                    automationTimeout: null,
                    sessionStartTime: null,
                    sessionInterval: null,
                    totalUptime: 0,
                    failedClicks: 0,
                    lastClickTime: null,
                    autoSaveInterval: null,
                    heartbeat: 0,
                    useIndexedDB: true,
                    useWebWorker: true
                };
                
                this.STORAGE_CONFIG = {
                    CLICK_COUNT: 'automation_clicks_v3',
                    SETTINGS: 'automation_settings_v3',
                    LOGS: 'automation_logs_v3',
                    SESSION: 'automation_session_v3',
                    STATS: 'automation_stats_v3',
                    PERMISSIONS: 'automation_permissions_v3'
                };
                
                this.init();
            }
            
            async init() {
                // Show permission dialog first
                this.showPermissionDialog();
                
                // Initialize DOM elements reference
                this.elements = {
                    totalClicks: document.getElementById('totalClicks'),
                    status: document.getElementById('status'),
                    sessionTime: document.getElementById('sessionTime'),
                    activityLog: document.getElementById('activityLog'),
                    startBtn: document.getElementById('startBtn'),
                    stopBtn: document.getElementById('stopBtn'),
                    testLink: document.getElementById('testLink'),
                    savedClicks: document.getElementById('savedClicks'),
                    uptime: document.getElementById('uptime'),
                    totalTime: document.getElementById('totalTime'),
                    successRate: document.getElementById('successRate'),
                    failedClicks: document.getElementById('failedClicks'),
                    lastSaved: document.getElementById('lastSaved'),
                    storageUsed: document.getElementById('storageUsed'),
                    dataStatus: document.getElementById('dataStatus'),
                    linkTargetPreview: document.getElementById('linkTargetPreview'),
                    dbStatus: document.getElementById('dbStatus'),
                    healthStatus: document.getElementById('healthStatus'),
                    heartbeat: document.getElementById('heartbeat')
                };
                
                // Setup event listeners
                this.setupEventListeners();
                
                // Initialize Web Worker
                this.initWebWorker();
                
                // Start heartbeat
                this.startHeartbeat();
                
                this.initialized = true;
            }
            
            showPermissionDialog() {
                const dialog = document.getElementById('permissionDialog');
                
                document.getElementById('grantPermissionBtn').onclick = () => {
                    this.grantAllPermissions();
                    dialog.style.display = 'none';
                    this.afterPermissionGranted();
                };
                
                document.getElementById('denyPermissionBtn').onclick = () => {
                    this.continueWithLimitedFeatures();
                    dialog.style.display = 'none';
                    this.afterPermissionGranted();
                };
                
                dialog.style.display = 'flex';
            }
            
            async grantAllPermissions() {
                try {
                    // Request notification permission
                    if ('Notification' in window) {
                        const permission = await Notification.requestPermission();
                        this.permissions.notifications = permission === 'granted';
                    }
                    
                    // Test IndexedDB
                    this.permissions.storage = await this.testStoragePermissions();
                    
                    // Web Worker permission (implicit)
                    this.permissions.worker = true;
                    
                    // Automation permission
                    this.permissions.automation = true;
                    
                    this.log('All permissions granted successfully', 'success');
                    this.showDataStatus('All permissions granted', 'success');
                    
                    // Save permissions
                    this.savePermissions();
                    
                } catch (error) {
                    this.log(`Permission error: ${error.message}`, 'error');
                    this.continueWithLimitedFeatures();
                }
            }
            
            continueWithLimitedFeatures() {
                this.permissions = {
                    storage: false, // Use sessionStorage instead
                    notifications: false,
                    worker: false, // Use setTimeout instead
                    automation: true // Basic automation still works
                };
                
                this.log('Continuing with limited features', 'warning');
                this.showDataStatus('Using limited features mode', 'warning');
                
                // Update UI to reflect limited mode
                document.getElementById('useIndexedDB').checked = false;
                document.getElementById('useIndexedDB').disabled = true;
                document.getElementById('notifications').checked = false;
                document.getElementById('notifications').disabled = true;
                document.getElementById('useWebWorker').checked = false;
                document.getElementById('useWebWorker').disabled = true;
                
                this.savePermissions();
            }
            
            async testStoragePermissions() {
                try {
                    // Test localStorage
                    const testKey = 'storage_test_' + Date.now();
                    localStorage.setItem(testKey, 'test');
                    localStorage.removeItem(testKey);
                    
                    // Test IndexedDB
                    const dbRequest = indexedDB.open('test_db', 1);
                    return new Promise((resolve) => {
                        dbRequest.onsuccess = () => {
                            indexedDB.deleteDatabase('test_db');
                            resolve(true);
                        };
                        dbRequest.onerror = () => resolve(false);
                        dbRequest.onblocked = () => resolve(false);
                    });
                } catch {
                    return false;
                }
            }
            
            savePermissions() {
                if (this.permissions.storage) {
                    localStorage.setItem(this.STORAGE_CONFIG.PERMISSIONS, 
                        JSON.stringify(this.permissions));
                }
            }
            
            loadPermissions() {
                try {
                    const saved = localStorage.getItem(this.STORAGE_CONFIG.PERMISSIONS);
                    if (saved) {
                        this.permissions = JSON.parse(saved);
                        return true;
                    }
                } catch (error) {
                    console.error('Error loading permissions:', error);
                }
                return false;
            }
            
            afterPermissionGranted() {
                // Initialize based on granted permissions
                this.state.useIndexedDB = this.permissions.storage && 
                    document.getElementById('useIndexedDB').checked;
                this.state.useWebWorker = this.permissions.worker && 
                    document.getElementById('useWebWorker').checked;
                
                // Load data if storage is permitted
                if (this.permissions.storage) {
                    this.loadAllData();
                }
                
                // Update UI
                this.updateTargetLink();
                this.updateStorageInfo();
                
                // Enable auto-save if permitted
                if (this.permissions.storage && document.getElementById('autoSave').checked) {
                    this.startAutoSave();
                }
                
                this.log('Automation Tool initialized with granted permissions', 'success');
            }
            
            initWebWorker() {
                if (!this.permissions.worker || !this.state.useWebWorker) {
                    this.log('Web Worker not available, using fallback timer', 'warning');
                    return;
                }
                
                try {
                    const workerBlob = new Blob([`
                        let timer = null;
                        self.onmessage = function(e) {
                            if (e.data.cmd === "start") {
                                clearInterval(timer);
                                timer = setInterval(() => {
                                    self.postMessage("tick");
                                }, e.data.delay);
                            }
                            if (e.data.cmd === "stop") {
                                clearInterval(timer);
                            }
                        };
                    `], { type: "application/javascript" });
                    
                    this.worker = new Worker(URL.createObjectURL(workerBlob));
                    this.worker.onmessage = (e) => {
                        if (e.data === "tick" && this.state.automationActive) {
                            this.performClickOperation();
                        }
                    };
                    
                    this.log('Web Worker initialized successfully', 'success');
                } catch (error) {
                    this.log(`Web Worker error: ${error.message}`, 'error');
                    this.state.useWebWorker = false;
                    document.getElementById('useWebWorker').checked = false;
                }
            }
            
            // ===============================
            // EXISTING METHODS PORTED TO CLASS
            // ===============================
            
            log(message, type = 'info') {
                const timestamp = new Date().toLocaleTimeString();
                const logEntry = document.createElement('div');
                logEntry.className = 'log-entry';
                
                const typeText = type.charAt(0).toUpperCase() + type.slice(1);
                logEntry.innerHTML = `
                    <span class="log-time">${timestamp}</span>
                    <span class="log-type log-type-${type}">${typeText}</span>
                    <span class="log-message">${message}</span>
                `;
                
                this.elements.activityLog.prepend(logEntry);
                
                if (this.elements.activityLog.children.length > 100) {
                    this.elements.activityLog.removeChild(this.elements.activityLog.lastChild);
                }
                
                if (document.getElementById('saveLogs').checked && 
                    this.permissions.storage && 
                    document.getElementById('autoSave').checked) {
                    localStorage.setItem(this.STORAGE_CONFIG.LOGS, this.elements.activityLog.innerHTML);
                }
            }
            
            showDataStatus(message, type = 'info', duration = 3000) {
                this.elements.dataStatus.textContent = message;
                this.elements.dataStatus.style.background = type === 'success' ? '#48bb78' : 
                                                           type === 'error' ? '#f56565' : 
                                                           type === 'warning' ? '#ed8936' : '#4299e1';
                
                this.elements.dataStatus.classList.add('show');
                
                setTimeout(() => {
                    this.elements.dataStatus.classList.remove('show');
                }, duration);
            }
            
            async loadAllData() {
                if (!this.permissions.storage) return;
                
                try {
                    // Load click count
                    const savedClicks = localStorage.getItem(this.STORAGE_CONFIG.CLICK_COUNT);
                    if (savedClicks) {
                        this.state.clickCount = parseInt(savedClicks);
                        this.elements.totalClicks.textContent = this.state.clickCount;
                        this.elements.savedClicks.textContent = `(Saved: ${this.state.clickCount})`;
                    }

                    // Load settings
                    const savedSettings = localStorage.getItem(this.STORAGE_CONFIG.SETTINGS);
                    if (savedSettings) {
                        const settings = JSON.parse(savedSettings);
                        document.getElementById('clickDelay').value = settings.clickDelay || 5;
                        document.getElementById('maxClicks').value = settings.maxClicks || 50;
                        document.getElementById('targetUrl').value = settings.targetUrl || 'https://example.com';
                        document.getElementById('openInNewTab').value = settings.openInNewTab || '_blank';
                        document.getElementById('autoResume').checked = settings.autoResume !== false;
                        document.getElementById('saveLogs').checked = settings.saveLogs !== false;
                        document.getElementById('notifications').checked = settings.notifications !== false;
                        document.getElementById('randomDelay').checked = settings.randomDelay !== false;
                        document.getElementById('autoSave').checked = settings.autoSave !== false;
                        document.getElementById('soundEffects').checked = settings.soundEffects || false;
                        document.getElementById('useIndexedDB').checked = settings.useIndexedDB !== false;
                        document.getElementById('useWebWorker').checked = settings.useWebWorker !== false;
                    }

                    // Load statistics
                    const savedStats = localStorage.getItem(this.STORAGE_CONFIG.STATS);
                    if (savedStats) {
                        const stats = JSON.parse(savedStats);
                        this.state.totalUptime = stats.totalUptime || 0;
                        this.state.failedClicks = stats.failedClicks || 0;
                        this.updateStatistics();
                    }

                    // Load logs if enabled
                    if (document.getElementById('saveLogs').checked) {
                        const savedLogs = localStorage.getItem(this.STORAGE_CONFIG.LOGS);
                        if (savedLogs) {
                            this.elements.activityLog.innerHTML = savedLogs;
                        }
                    }

                    // Load last saved timestamp
                    const lastSaved = localStorage.getItem('last_saved_timestamp');
                    if (lastSaved) {
                        this.elements.lastSaved.textContent = new Date(parseInt(lastSaved)).toLocaleTimeString();
                    }

                    // Check for auto-resume
                    const savedSession = localStorage.getItem(this.STORAGE_CONFIG.SESSION);
                    if (savedSession && document.getElementById('autoResume').checked) {
                        const session = JSON.parse(savedSession);
                        if (session.active) {
                            setTimeout(() => {
                                this.log("Resuming previous session...", 'info');
                                this.startAutomation();
                            }, 500);
                        }
                    }

                    this.log("All data loaded from persistent storage", 'success');
                } catch (error) {
                    console.error("Error loading data:", error);
                    this.log("Error loading saved data", 'error');
                }
            }
            
            saveAllData() {
                if (!this.permissions.storage) return;
                
                try {
                    // Update state from checkboxes
                    this.state.useIndexedDB = document.getElementById('useIndexedDB').checked;
                    this.state.useWebWorker = document.getElementById('useWebWorker').checked;

                    // Save to localStorage
                    localStorage.setItem(this.STORAGE_CONFIG.CLICK_COUNT, this.state.clickCount.toString());

                    // Save settings
                    const settings = {
                        clickDelay: document.getElementById('clickDelay').value,
                        maxClicks: document.getElementById('maxClicks').value,
                        targetUrl: document.getElementById('targetUrl').value,
                        openInNewTab: document.getElementById('openInNewTab').value,
                        autoResume: document.getElementById('autoResume').checked,
                        saveLogs: document.getElementById('saveLogs').checked,
                        notifications: document.getElementById('notifications').checked,
                        randomDelay: document.getElementById('randomDelay').checked,
                        autoSave: document.getElementById('autoSave').checked,
                        soundEffects: document.getElementById('soundEffects').checked,
                        useIndexedDB: this.state.useIndexedDB,
                        useWebWorker: this.state.useWebWorker,
                        lastUpdated: new Date().toISOString()
                    };
                    localStorage.setItem(this.STORAGE_CONFIG.SETTINGS, JSON.stringify(settings));

                    // Save statistics
                    const stats = {
                        totalUptime: this.state.totalUptime,
                        failedClicks: this.state.failedClicks,
                        totalClicks: this.state.clickCount,
                        lastSession: this.state.sessionStartTime || null
                    };
                    localStorage.setItem(this.STORAGE_CONFIG.STATS, JSON.stringify(stats));

                    // Save logs if enabled
                    if (document.getElementById('saveLogs').checked) {
                        localStorage.setItem(this.STORAGE_CONFIG.LOGS, this.elements.activityLog.innerHTML);
                    }

                    // Save session state
                    const session = {
                        active: this.state.automationActive,
                        startTime: this.state.sessionStartTime,
                        clickCount: this.state.clickCount,
                        lastUpdate: Date.now()
                    };
                    localStorage.setItem(this.STORAGE_CONFIG.SESSION, JSON.stringify(session));

                    // Update last saved timestamp
                    const now = Date.now();
                    localStorage.setItem('last_saved_timestamp', now.toString());
                    this.elements.lastSaved.textContent = new Date(now).toLocaleTimeString();

                    this.updateStorageInfo();
                    this.showDataStatus('Data saved successfully', 'success');
                } catch (error) {
                    console.error("Error saving data:", error);
                    this.showDataStatus('Error saving data', 'error');
                }
            }
            
            // ===============================
            // AUTOMATION METHODS
            // ===============================
            
            performClickOperation() {
                if (!this.state.automationActive || !this.permissions.automation) return;
                
                const maxClicks = parseInt(document.getElementById('maxClicks').value);
                
                // Check if we've reached max clicks
                if (maxClicks > 0 && this.state.clickCount >= maxClicks) {
                    this.log("Maximum clicks reached. Automation stopped.", 'info');
                    this.stopAutomation();
                    return;
                }
                
                try {
                    // Update link before clicking
                    this.updateTargetLink();
                    
                    // Simulate click
                    const event = new MouseEvent('click', {
                        view: window,
                        bubbles: true,
                        cancelable: true
                    });
                    
                    this.elements.testLink.dispatchEvent(event);
                    this.state.clickCount++;
                    this.elements.totalClicks.textContent = this.state.clickCount;
                    this.state.lastClickTime = Date.now();
                    
                    // Show notification if enabled and permitted
                    if (document.getElementById('notifications').checked && this.permissions.notifications) {
                        this.showNotification(`Click #${this.state.clickCount} simulated`);
                    }
                    
                    this.log(`Click #${this.state.clickCount} simulated. Opening: ${this.elements.testLink.href}`, 'success');
                    
                    // Save progress if storage is permitted
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                    
                } catch (error) {
                    this.state.failedClicks++;
                    this.log(`Error on click #${this.state.clickCount + 1}: ${error.message}`, 'error');
                    this.updateStatistics();
                }
            }
            
            startAutomation() {
                if (this.state.automationActive || !this.permissions.automation) return;
                
                this.state.automationActive = true;
                this.state.sessionStartTime = Date.now();
                
                // Update health status
                this.elements.healthStatus.textContent = "RUNNING";
                this.elements.healthStatus.style.color = "#68d391";
                
                // Update UI
                this.elements.startBtn.disabled = true;
                this.elements.stopBtn.disabled = false;
                this.elements.status.innerHTML = '<span class="status-indicator status-running"></span> Running';
                this.elements.status.style.color = '#48bb78';
                
                this.log("Automation started successfully", 'success');
                
                // Start session timer
                this.state.sessionInterval = setInterval(() => this.updateSessionTimer(), 1000);
                
                // Save session state if storage is permitted
                if (this.permissions.storage) {
                    this.saveAllData();
                }
                
                // Show notification if enabled and permitted
                if (document.getElementById('notifications').checked && this.permissions.notifications) {
                    this.showNotification("Automation started");
                }
                
                // Start automation based on selected method
                if (this.state.useWebWorker && this.worker) {
                    const delay = parseFloat(document.getElementById('clickDelay').value) * 1000;
                    this.worker.postMessage({ cmd: "start", delay: delay });
                    this.log("Web Worker timer started", 'success');
                } else {
                    // Use traditional setTimeout method
                    const initialDelay = 2000;
                    this.state.automationTimeout = setTimeout(() => {
                        const runClick = () => {
                            if (!this.state.automationActive) return;
                            
                            this.performClickOperation();
                            
                            // Calculate next delay
                            let delay = parseFloat(document.getElementById('clickDelay').value) * 1000;
                            if (document.getElementById('randomDelay').checked) {
                                const variation = delay * 0.1;
                                delay += (Math.random() * variation * 2) - variation;
                            }
                            
                            // Schedule next click
                            if (this.state.automationActive) {
                                this.state.automationTimeout = setTimeout(runClick, delay);
                            }
                        };
                        runClick();
                    }, initialDelay);
                }
            }
            
            stopAutomation() {
                if (!this.state.automationActive) return;
                
                this.state.automationActive = false;
                
                // Update health status
                this.elements.healthStatus.textContent = "STOPPED";
                this.elements.healthStatus.style.color = "#f56565";
                
                // Calculate and save total uptime
                if (this.state.sessionStartTime) {
                    const sessionUptime = Math.floor((Date.now() - this.state.sessionStartTime) / 1000);
                    this.state.totalUptime += sessionUptime;
                    this.state.sessionStartTime = null;
                }
                
                // Stop timer based on method
                if (this.state.useWebWorker && this.worker) {
                    this.worker.postMessage({ cmd: "stop" });
                } else {
                    if (this.state.automationTimeout) {
                        clearTimeout(this.state.automationTimeout);
                        this.state.automationTimeout = null;
                    }
                }
                
                if (this.state.sessionInterval) {
                    clearInterval(this.state.sessionInterval);
                    this.state.sessionInterval = null;
                }
                
                // Update UI
                this.elements.startBtn.disabled = false;
                this.elements.stopBtn.disabled = true;
                this.elements.status.innerHTML = '<span class="status-indicator status-stopped"></span> Stopped';
                this.elements.status.style.color = '#f56565';
                
                // Update statistics
                this.updateStatistics();
                
                this.log("Automation stopped", 'info');
                
                // Save final state if storage is permitted
                if (this.permissions.storage) {
                    this.saveAllData();
                }
                
                // Show notification if enabled and permitted
                if (document.getElementById('notifications').checked && this.permissions.notifications) {
                    this.showNotification("Automation stopped");
                }
            }
            
            // ===============================
            // HELPER METHODS
            // ===============================
            
            updateTargetLink() {
                const url = document.getElementById('targetUrl').value;
                const target = document.getElementById('openInNewTab').value;
                
                this.elements.testLink.href = url;
                this.elements.testLink.target = target;
                
                const targetText = target === '_blank' ? 'New Tab' : 
                                 target === '_self' ? 'Same Tab' : 'Parent Frame';
                this.elements.linkTargetPreview.textContent = targetText;
                
                if (document.getElementById('autoSave').checked && this.permissions.storage) {
                    this.saveAllData();
                }
            }
            
            updateSessionTimer() {
                if (this.state.sessionStartTime) {
                    const elapsed = Math.floor((Date.now() - this.state.sessionStartTime) / 1000);
                    this.elements.sessionTime.textContent = `${elapsed}s`;
                    
                    const totalUptime = this.state.totalUptime + elapsed;
                    const hours = Math.floor(totalUptime / 3600);
                    const minutes = Math.floor((totalUptime % 3600) / 60);
                    const seconds = totalUptime % 60;
                    this.elements.uptime.textContent = `Uptime: ${hours}h ${minutes}m ${seconds}s`;
                }
            }
            
            updateStatistics() {
                const totalAttempts = this.state.clickCount + this.state.failedClicks;
                const successRate = totalAttempts > 0 ? 
                    Math.round((this.state.clickCount / totalAttempts) * 100) : 100;
                this.elements.successRate.textContent = `${successRate}%`;
                this.elements.failedClicks.textContent = `Failed: ${this.state.failedClicks}`;
                
                const totalTime = this.state.totalUptime;
                const hours = Math.floor(totalTime / 3600);
                const minutes = Math.floor((totalTime % 3600) / 60);
                this.elements.totalTime.textContent = `Total: ${hours}h ${minutes}m`;
            }
            
            resetStats() {
                if (confirm("Are you sure you want to reset all statistics? This cannot be undone.")) {
                    this.state.clickCount = 0;
                    this.state.failedClicks = 0;
                    this.state.totalUptime = 0;
                    
                    this.elements.totalClicks.textContent = '0';
                    this.elements.sessionTime.textContent = '0s';
                    this.elements.uptime.textContent = 'Uptime: 0s';
                    
                    if (this.state.automationActive) {
                        this.stopAutomation();
                    }
                    
                    this.updateStatistics();
                    
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                    
                    this.log("All statistics have been reset", 'warning');
                }
            }
            
            exportData() {
                const data = {
                    metadata: {
                        version: '3.0',
                        exportDate: new Date().toISOString(),
                        tool: 'Educational Automation Tool',
                        permissions: this.permissions
                    },
                    statistics: {
                        clickCount: this.state.clickCount,
                        failedClicks: this.state.failedClicks,
                        totalUptime: this.state.totalUptime,
                        lastClick: this.state.lastClickTime ? new Date(this.state.lastClickTime).toISOString() : null
                    },
                    settings: {
                        clickDelay: document.getElementById('clickDelay').value,
                        maxClicks: document.getElementById('maxClicks').value,
                        targetUrl: document.getElementById('targetUrl').value,
                        openInNewTab: document.getElementById('openInNewTab').value,
                        useIndexedDB: this.state.useIndexedDB,
                        useWebWorker: this.state.useWebWorker
                    },
                    logs: this.elements.activityLog.innerHTML,
                    session: {
                        active: this.state.automationActive,
                        startTime: this.state.sessionStartTime
                    }
                };
                
                const dataStr = JSON.stringify(data, null, 2);
                const dataBlob = new Blob([dataStr], { type: 'application/json' });
                const url = URL.createObjectURL(dataBlob);
                
                const a = document.createElement('a');
                a.href = url;
                const dateStr = new Date().toISOString().split('T')[0];
                a.download = `automation-backup-${dateStr}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
                
                this.log("Data exported to backup file", 'success');
                this.showDataStatus('Data exported successfully', 'success');
            }
            
            importData() {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = '.json';
                
                input.onchange = (e) => {
                    const file = e.target.files[0];
                    if (!file) return;
                    
                    const reader = new FileReader();
                    
                    reader.onload = (event) => {
                        try {
                            const data = JSON.parse(event.target.result);
                            
                            if (data.statistics) {
                                this.state.clickCount = parseInt(data.statistics.clickCount) || 0;
                                this.state.failedClicks = parseInt(data.statistics.failedClicks) || 0;
                                this.state.totalUptime = parseInt(data.statistics.totalUptime) || 0;
                                
                                this.elements.totalClicks.textContent = this.state.clickCount;
                                this.updateStatistics();
                            }
                            
                            if (data.settings) {
                                document.getElementById('clickDelay').value = data.settings.clickDelay || 5;
                                document.getElementById('maxClicks').value = data.settings.maxClicks || 50;
                                document.getElementById('targetUrl').value = data.settings.targetUrl || 'https://example.com';
                                document.getElementById('openInNewTab').value = data.settings.openInNewTab || '_blank';
                                document.getElementById('useIndexedDB').checked = data.settings.useIndexedDB !== false;
                                document.getElementById('useWebWorker').checked = data.settings.useWebWorker !== false;
                                this.state.useIndexedDB = document.getElementById('useIndexedDB').checked;
                                this.state.useWebWorker = document.getElementById('useWebWorker').checked;
                                this.updateTargetLink();
                            }
                            
                            if (data.logs) {
                                this.elements.activityLog.innerHTML = data.logs;
                            }
                            
                            if (this.permissions.storage) {
                                this.saveAllData();
                            }
                            
                            this.log(`Data imported from backup (${data.metadata?.exportDate || 'unknown date'})`, 'success');
                            this.showDataStatus('Data imported successfully', 'success');
                            
                        } catch (error) {
                            this.log("Error importing data: Invalid file format", 'error');
                            this.showDataStatus('Import failed: Invalid file', 'error');
                        }
                    };
                    
                    reader.readAsText(file);
                };
                
                input.click();
            }
            
            clearLogs() {
                if (confirm("Clear all activity logs?")) {
                    this.elements.activityLog.innerHTML = '';
                    
                    if (this.permissions.storage) {
                        localStorage.removeItem(this.STORAGE_CONFIG.LOGS);
                    }
                    
                    this.log("All logs cleared", 'warning');
                }
            }
            
            toggleAdvanced() {
                const content = document.getElementById('advancedContent');
                const toggle = document.getElementById('advancedToggle');
                
                if (content.style.display === 'none') {
                    content.style.display = 'grid';
                    toggle.textContent = '‚ñ≤';
                } else {
                    content.style.display = 'none';
                    toggle.textContent = '‚ñº';
                }
            }
            
            startAutoSave() {
                if (!this.permissions.storage) return;
                
                if (this.state.autoSaveInterval) {
                    clearInterval(this.state.autoSaveInterval);
                }
                
                this.state.autoSaveInterval = setInterval(() => {
                    if (document.getElementById('autoSave').checked) {
                        this.saveAllData();
                        this.showDataStatus('Auto-saved', 'info', 1000);
                    }
                }, 30000);
            }
            
            updateStorageInfo() {
                if (!this.permissions.storage) {
                    this.elements.storageUsed.textContent = 'N/A (No storage permission)';
                    return;
                }
                
                let totalSize = 0;
                for (let key in localStorage) {
                    if (localStorage.hasOwnProperty(key)) {
                        totalSize += localStorage[key].length * 2;
                    }
                }
                this.elements.storageUsed.textContent = `${(totalSize / 1024).toFixed(2)} KB`;
            }
            
            startHeartbeat() {
                setInterval(() => {
                    this.state.heartbeat++;
                    this.elements.heartbeat.textContent = this.state.heartbeat;
                }, 1000);
            }
            
            showNotification(message) {
                if (!this.permissions.notifications) return;
                
                if (Notification.permission === "granted") {
                    new Notification("Automation Tool", {
                        body: message,
                        icon: 'data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="%2348bb78"><path d="M0 0h24v24H0z" fill="none"/><path d="M9 21c0 .55.45 1 1 1h4c.55 0 1-.45 1-1v-1H9v1zm3-19C8.14 2 5 5.14 5 9c0 2.38 1.19 4.47 3 5.74V17c0 .55.45 1 1 1h6c.55 0 1-.45 1-1v-2.26c1.81-1.27 3-3.36 3-5.74 0-3.86-3.14-7-7-7z"/></svg>'
                    });
                }
            }
            
            // ===============================
            // EVENT LISTENERS
            // ===============================
            
            setupEventListeners() {
                // Button listeners
                this.elements.startBtn.addEventListener('click', () => this.startAutomation());
                this.elements.stopBtn.addEventListener('click', () => this.stopAutomation());
                document.getElementById('resetBtn').addEventListener('click', () => this.resetStats());
                document.getElementById('exportBtn').addEventListener('click', () => this.exportData());
                document.getElementById('importBtn').addEventListener('click', () => this.importData());
                document.getElementById('clearLogsBtn').addEventListener('click', () => this.clearLogs());
                
                // Advanced settings toggle
                document.getElementById('advancedHeader').addEventListener('click', () => this.toggleAdvanced());
                
                // Settings change listeners
                document.getElementById('targetUrl').addEventListener('input', () => this.updateTargetLink());
                document.getElementById('openInNewTab').addEventListener('change', () => this.updateTargetLink());
                
                document.getElementById('clickDelay').addEventListener('change', function() {
                    this.log(`Click delay changed to ${this.value} seconds`, 'info');
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                }.bind(this));
                
                document.getElementById('maxClicks').addEventListener('change', function() {
                    this.log(`Maximum clicks changed to ${this.value}`, 'info');
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                }.bind(this));
                
                document.getElementById('autoSave').addEventListener('change', function() {
                    if (this.checked && this.permissions.storage) {
                        this.startAutoSave();
                        this.showDataStatus('Auto-save enabled', 'success');
                    } else {
                        clearInterval(this.state.autoSaveInterval);
                        this.showDataStatus('Auto-save disabled', 'warning');
                    }
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                }.bind(this));
                
                document.getElementById('useIndexedDB').addEventListener('change', function() {
                    this.state.useIndexedDB = this.checked;
                    this.log(`IndexedDB ${this.checked ? 'enabled' : 'disabled'}`, 'info');
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                }.bind(this));
                
                document.getElementById('useWebWorker').addEventListener('change', function() {
                    this.state.useWebWorker = this.checked;
                    this.log(`Web Worker ${this.checked ? 'enabled' : 'disabled'}`, 'info');
                    if (this.permissions.storage) {
                        this.saveAllData();
                    }
                }.bind(this));
                
                // Keyboard shortcuts
                document.addEventListener('keydown', (e) => {
                    if (e.code === 'Space' && !e.target.matches('input, textarea, select')) {
                        e.preventDefault();
                        if (this.state.automationActive) {
                            this.stopAutomation();
                        } else {
                            this.startAutomation();
                        }
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 's') {
                        e.preventDefault();
                        this.startAutomation();
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 'p') {
                        e.preventDefault();
                        this.stopAutomation();
                    }
                    if (e.key === 'Escape') {
                        this.stopAutomation();
                    }
                    if ((e.ctrlKey || e.metaKey) && e.key === 'e') {
                        e.preventDefault();
                        this.exportData();
                    }
                });
                
                // Visibility change
                document.addEventListener('visibilitychange', () => {
                    if (document.hidden && this.state.automationActive) {
                        this.log("Browser tab hidden - automation continues in background", 'info');
                    }
                });
                
                // Before unload
                window.addEventListener('beforeunload', (e) => {
                    if (this.state.automationActive) {
                        e.preventDefault();
                        e.returnValue = 'Automation is still running. Are you sure you want to leave?';
                        return e.returnValue;
                    }
                });
            }
        }

        // ===============================
        // INITIALIZATION
        // ===============================
        let automationTool;

        // Wait for DOM to be fully loaded
        document.addEventListener('DOMContentLoaded', () => {
            automationTool = new AutomationTool();
        });

        // Export for debugging
        window.AutomationTool = AutomationTool;
    </script>
</body>
</html>
